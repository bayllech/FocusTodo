# MVP需求文档

## 1. 项目背景与目标
- 构建一款跨 Windows/macOS 的轻量级桌面待办与番茄钟应用，核心特征为常驻悬浮小窗、mac 风格视觉与本地数据存储。
- 以提高个人知识工作者的任务管理效率与专注力为目标，首版限定单机离线使用，后续预留云同步扩展点。

## 2. 用户画像
- 使用 Windows 与 macOS 的个人开发者、产品或设计从业者。
- 偏好番茄效率法，需随时查看任务列表与当前专注状态。
- 注重界面美观与交互细节，希望小窗不打扰又随取随用。

## 3. MVP 范围界定
- 包含任务管理、番茄钟、悬浮小窗、基础设置与本地数据管理。
- 不包含多人协作、云同步、高级统计分析、移动端。
- 数据存储量小，全部保存在本地 JSON 文件中。

## 4. 功能需求
### 4.1 任务管理
- 新建任务：支持标题、描述、优先级（低/中/高）、标签、计划时间/截止时间。
- 编辑任务：可修改上述全部字段。
- 删除任务：单条删除并可确认。
- 完成状态切换：支持标记完成与恢复未完成，自动记录完成时间。
- 列表操作：按标签筛选、关键字搜索、优先级排序。

### 4.2 番茄钟
- 配置项：专注、短休、长休时长；长休间隔；是否自动进入下一阶段。
- 计时流程：选择任务后启动番茄钟，支持暂停/继续/停止。
- 提醒机制：阶段结束触发系统通知与提示音。
- 历史记录：记录当日番茄 Session，展示当前累计时长。

### 4.3 窗口体系
- 主窗口：提供完整任务与设置管理，支持亮暗主题切换。
- 悬浮小窗：置顶、可拖拽、无边框、透明磨砂效果，展示当前番茄状态与核心任务列表，可快速完成或开始任务。
- 托盘菜单：显示/隐藏各窗口、快速开始番茄钟、退出应用。

### 4.4 设置面板
- 主题：亮色、暗色、mac 风格预设，允许跟随系统。
- 窗口行为：置顶开关、贴边吸附开关。
- 快捷键：设置唤醒小窗、开始/暂停番茄钟的全局快捷键。
- 数据：手动导出 JSON、查看每日自动备份状态。

## 5. 非功能性需求与约束
- 跨平台：兼容 Windows 10+、macOS 12+，交互与视觉保持一致。
- 性能：启动时间小于 2 秒；常驻内存小于 150 MB；番茄钟计时误差小于 0.5 秒。
- 安全：数据目录位于用户家目录下的应用专属文件夹，写入采用临时文件替换；命令参数需校验，防止注入或非法路径访问。
- 视觉：字体优先使用 SF Pro/苹方/微软雅黑，统一圆角 12px、柔和阴影与 `backdrop-filter` 模糊效果，适配暗色模式。

## 6. 关键业务流程
1. **新建任务流程**：用户输入任务信息 → 前端生成 `id` 与时间戳 → 调用 `create_todo` → Rust 写入 JSON → 返回成功 → 前端状态刷新 → 悬浮小窗同步更新。
2. **番茄钟流程**：用户选择任务并启动 → 前端启动计时 → 阶段结束时触发通知与提示音 → 若自动进入下一阶段则继续，否则等待用户确认 → 记录番茄 Session。
3. **悬浮小窗操作**：应用启动自动打开小窗 → 用户可拖拽移动，位置调整通过命令同步存储 → 双击可展开/折叠 → 与主窗口共享任务与番茄状态。

## 7. 数据模型
- `TodoItem`：`id`, `title`, `detail`, `priority`, `tags[]`, `plannedAt`, `dueAt`, `completed`, `completedAt`, `createdAt`, `updatedAt`。
- `PomodoroConfig`：`focusMinutes`, `shortBreakMinutes`, `longBreakMinutes`, `longBreakInterval`, `autoStartNext`。
- `PomodoroSession`：`id`, `todoId`, `type`, `startAt`, `endAt`, `completed`。
- `UserSettings`：`theme`, `alwaysOnTop`, `snapEdge`, `hotkeys`, `windowState`。
- 存储结构：`data/todos.json`、`data/pomodoro.json`、`data/settings.json`，每日自动生成带日期后缀的备份文件。

## 8. Tauri 命令接口
- 任务：`list_todos()`, `create_todo(todo)`, `update_todo(todo)`, `delete_todo(id)`, `toggle_complete(id)`。
- 番茄钟：`get_pomodoro_config()`, `save_pomodoro_config(config)`, `append_pomodoro_session(session)`, `list_pomodoro_sessions(date)`。
- 设置：`get_settings()`, `save_settings(settings)`。
- 窗口与系统：`set_window_position(windowId, x, y)`, `toggle_window_visibility(windowId)`。

## 9. 验收标准
- 任务新增、编辑、删除、完成状态切换在主窗与小窗同步生效，无明显延迟。
- 番茄钟在后台或最小化状态下仍能准确计时，并发出通知与提示音。
- 本地数据文件按预期生成，包含每日备份；损坏或缺失时应用能提示并自动恢复最近备份。
- Windows 与 macOS 打包产物均可安装运行，主窗、小窗、托盘操作稳定。
- UI 满足 mac 风格设计规范，暗色模式显示正常，无明显渲染卡顿。

## 10. 开发阶段规划
1. 脚手架搭建与窗口原型：初始化 Tauri + React + Vite，创建主窗与悬浮小窗，接入托盘。
2. 数据命令与任务列表：实现 JSON 存储、基本命令、前端状态管理与任务列表界面。
3. 番茄钟核心：实现倒计时逻辑、配置面板、Session 记录、通知/提示音。
4. UI 细化与交互：完善 mac 风格主题、小窗交互、任务筛选排序、搜索体验。
5. 设置与快捷键：实现窗口行为配置、全局快捷键、数据导出与备份提醒。
6. 测试与打包：单元与集成测试、Windows MSI 与 mac DMG 打包、跨平台验证。

## 11. 风险与后续规划
- 透明与磨砂效果在不同系统上的表现需验证，可能需要额外样式或原生 API 调整。
- JSON 文件并发写入存在损坏风险，需要文件锁或写入队列保证原子性。
- 系统休眠或锁屏对番茄钟计时的影响需测试，必要时通过 Rust 后台计时确保精度。
- 后续可扩展多语言、统计分析、云同步等功能，MVP 设计已预留接口与数据模型扩展位。
